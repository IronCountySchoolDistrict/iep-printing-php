{"version":3,"sources":["loading-modal.js","iep.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["var loadingModal;\r\nloadingModal = loadingModal || (function() {\r\n  var loadingDiv = $('#loadingDialog');\r\n  return {\r\n    show: function() {\r\n      loadingDiv.modal('show');\r\n    },\r\n    hide: function() {\r\n      loadingDiv.modal('hide');\r\n    }\r\n  }\r\n})();\r\n","var iepContent = {};\r\n\r\nfunction status(response) {\r\n  if (response.status >= 200 && response.status < 300) {\r\n    return Promise.resolve(response);\r\n  } else {\r\n    return Promise.reject(new Error(response.statusText));\r\n  }\r\n}\r\n\r\nfunction json(response) {\r\n  return response.json();\r\n}\r\n\r\nfunction html(response) {\r\n  return response.text();\r\n}\r\n\r\nfunction resizeContent() {\r\n  var windowHeight = $(window).height();\r\n  var SPACE_ABOVE_CONTENT = 71;\r\n  var iepHeight = windowHeight - SPACE_ABOVE_CONTENT;\r\n  var iepListHeight = iepHeight - 55;\r\n  $('.iep').css('height', iepHeight + 'px');\r\n  $('.iep-list').css('height', iepListHeight + 'px');\r\n}\r\n\r\nfunction iepSnippetClickHandler(event) {\r\n  iepSnippet = $(event.target);\r\n  if (!iepSnippet.hasClass('iep-snippet')) {\r\n    iepSnippet = iepSnippet.parents('.iep-snippet');\r\n  }\r\n\r\n  if (iepSnippet.hasClass('active')) {\r\n    return;\r\n  }\r\n\r\n  loadingModal.show();\r\n\r\n  $('.iep-snippet.active .case-manager').replaceWith(function() {\r\n    return $('<span class=\"'+$(this).prop('class')+'\">' + this.innerHTML + '</span>');\r\n  });\r\n  $('.iep-snippet.active .start-date').replaceWith(function() {\r\n    return $('<span class=\"'+$(this).prop('class')+'\">' + this.innerHTML + '</span>');\r\n  });\r\n\r\n  $('.iep-snippet.active').removeClass('active');\r\n  iepSnippet.addClass('active');\r\n\r\n  loadIep();\r\n}\r\n\r\nfunction loadIep() {\r\n  $('.iep').empty();\r\n  var iepid = $('.iep-snippet.active').prop('id');\r\n  if (typeof iepContent[iepid] === \"undefined\") {\r\n    var params = [\r\n      'iep=' + iepid,\r\n      'frn=' + frn\r\n    ];\r\n    window.fetch('iep?' + params.join('&'))\r\n      .then(status)\r\n      .then(html)\r\n      .then(function(html) {\r\n        $('.iep').append(html);\r\n        iepContent[iepid] = html;\r\n        styleIep();\r\n      });\r\n  } else {\r\n    $('.iep').append(iepContent[iepid]);\r\n    styleIep();\r\n  }\r\n}\r\n\r\nfunction styleIep() {\r\n  $('.iep-table').dataTable({\r\n    \"paging\": false,\r\n    \"ordering\": false,\r\n    \"bInfo\": false\r\n  });\r\n\r\n  $('.iep-table input[type=checkbox], .iep input[type=radio]').iCheck({\r\n    checkboxClass: 'icheckbox_flat-blue',\r\n    radioClass: 'iradio_flat-blue'\r\n  });\r\n\r\n  $('.iep-table input[type=checkbox]').on('ifChanged', checkboxWatcher);\r\n  $('#btnPrintSelection').on('click', printForms);\r\n\r\n  var caseManagerHref = $('.iep-table a:contains(\"IEP: SpEd 51\")').prop('href') + '&case_manager';\r\n  $('.iep-snippet.active .case-manager').replaceWith(function() {\r\n    return $('<a target=\"_blank\" href=\"'+caseManagerHref+'\" class=\"'+$(this).prop('class')+'\">' + this.innerHTML + '</a>');\r\n  });\r\n\r\n  var startDateHref = $('.iep-table a:contains(\"IEP: SpEd 6a1\")').prop('href') + '&start_date';\r\n  $('.iep-snippet.active .start-date').replaceWith(function() {\r\n    return $('<a target=\"_blank\" href=\"'+startDateHref+'\" class=\"'+$(this).prop('class')+'\">' + this.innerHTML + '</a>');\r\n  });\r\n\r\n  loadingModal.hide();\r\n}\r\n\r\nfunction checkboxWatcher(event) {\r\n  var RESPONSE_CHECKS = '.iep-table input[name=\"response[]\"]';\r\n\r\n  var checkboxCount = $(RESPONSE_CHECKS).length;\r\n  var checkedBoxCount = $(RESPONSE_CHECKS + ':checked').length;\r\n\r\n  if (event.target.name === 'master') {\r\n    if (event.target.checked) {\r\n      $(RESPONSE_CHECKS).iCheck('check');\r\n    } else {\r\n      if (checkboxCount == checkedBoxCount) {\r\n        $(RESPONSE_CHECKS).iCheck('uncheck');\r\n      }\r\n    }\r\n  } else {\r\n    if (checkboxCount == checkedBoxCount) {\r\n      $('.iep-table input[name=master]').iCheck('check');\r\n    } else {\r\n      $('.iep-table input[name=master]').iCheck('uncheck');\r\n    }\r\n  }\r\n}\r\n\r\nfunction createIep() {\r\n  var inputElement = $('.new-iep-modal input[name=\"start-date\"]');\r\n  var dateRegex = /^(0[1-9]|1[0-2])\\/(0[1-9]|1\\d|2\\d|3[01])\\/(19|20)\\d{2}$/;\r\n\r\n  if (!dateRegex.test(inputElement.val())) {\r\n    $('.new-iep-modal .form-group').addClass('has-warning');\r\n    $('.new-iep-modal .help-block').text('Sorry, the date must math the MM/DD/YYYY format');\r\n\r\n    return;\r\n  }\r\n\r\n  $('.new-iep-modal .btn').prop('disabled', true);\r\n  $('.new-iep-modal .btn-success > i').removeClass('hide');\r\n\r\n  window.fetch('iep', {\r\n    method: 'POST',\r\n    body: JSON.stringify({\r\n      start_date: inputElement.val(),\r\n      user: user,\r\n      student: student\r\n    })\r\n  }).then(status)\r\n    .then(html)\r\n    .then(function(data) {\r\n      $('.iep-list .scroll-content').prepend(data);\r\n      $('.iep-list .iep-snippet').first().find('#activate-iep').on('click', activateIep);\r\n      $('.new-iep-modal').modal('hide');\r\n      $('.new-iep-modal input').val('');\r\n      $('.new-iep-modal .btn').prop('disabled', false);\r\n      $('.new-iep-modal .btn-success > i').addClass('hide');\r\n      $('.iep-list .iep-snippet').first().on('click', iepSnippetClickHandler);\r\n      $('.iep-list .iep-snippet').first().click();\r\n    });\r\n}\r\n\r\nfunction printForms() {\r\n  if ($('.iep-table input[name=\"response[]\"]:checked').length < 1) {\r\n    alert('There are no forms selected.');\r\n    return;\r\n  }\r\n\r\n  togglePrintBtn('disable');\r\n\r\n  var selected = [];\r\n  $('.iep-table input[name=\"response[]\"]:checked').each(function(index, element) {\r\n    selected.push({\r\n      formid: $(element).attr('data-form-id'),\r\n      title: $(element).attr('data-form-title'),\r\n      responseid: $(element).val()\r\n    });\r\n  });\r\n\r\n  window.fetch('iep/print', {\r\n    method: 'POST',\r\n    body: JSON.stringify({\r\n      selected: selected,\r\n      student: student,\r\n      fileOption: $('input[name=fileOption]').val(),\r\n      watermarkOption: $('input[name=watermarkOption]').val()\r\n    })\r\n  }).then(status)\r\n    .then(json)\r\n    .then(function(data) {\r\n      if (data.file.length > 0) {\r\n        var win = window.open(data.file, '_blank');\r\n        if (win) {\r\n          win.focus();\r\n        } else {\r\n          alert('ERROR: Please allow popups for this page.'); // TODO: better way to alert/inform?\r\n        }\r\n      }\r\n\r\n      $('input[name=\"response[]\"]:checked').each(function(index, element) {\r\n        var parentElement = $(element).parents('tr');\r\n        if (parentElement.hasClass('error')) {\r\n          $(element).parents('tr').removeClass('error');\r\n          $(element).parents('tr').find('.form-error').text('');\r\n        }\r\n      });\r\n\r\n      for (var key in data.error) {\r\n        var row = $('.iep-table #' + key);\r\n        row.addClass('error');\r\n        row.find('.form-error').text(data.error[key]);\r\n      }\r\n\r\n      togglePrintBtn('enable');\r\n    });\r\n}\r\n\r\nfunction togglePrintBtn(action) {\r\n  if (action === 'disable') {\r\n    $('#btnPrintSelection').prop('disabled', true);\r\n    $('#btnPrintSelection > i').removeClass('hide');\r\n  } else {\r\n    $('#btnPrintSelection').prop('disabled', false);\r\n    $('#btnPrintSelection > i').addClass('hide');\r\n  }\r\n}\r\n\r\nfunction deleteIep() {\r\n  var inputElement = $('.delete-iep-modal input[name=\"confirm-delete\"]');\r\n\r\n  if (inputElement.val() !== 'DELETE') {\r\n    inputElement.val('');\r\n    inputElement.parent().addClass('has-warning');\r\n    inputElement.siblings('.help-block').text('Sorry, please enter the text exactly as displayed to confirm.');\r\n    inputElement.focus();\r\n\r\n    return;\r\n  }\r\n\r\n  $('.delete-iep-modal .btn-danger').prop('disabled', true);\r\n  $('.delete-iep-modal .btn-danger > i').removeClass('hide');\r\n\r\n  inputElement.parent().removeClass('has-warning');\r\n  inputElement.siblings('.help-block').text('');\r\n\r\n  var iepid = $('.iep-snippet.active').prop('id');\r\n\r\n  window.fetch('iep/response-count?iep=' + iepid)\r\n    .then(status)\r\n    .then(json)\r\n    .then(function(count) {\r\n      if (count < 1) {\r\n        window.fetch('iep/delete', {\r\n          method: 'POST',\r\n          body: JSON.stringify({\r\n            iep: iepid\r\n          })\r\n        }).then(status)\r\n          .then(json)\r\n          .then(function(response) {\r\n            if (response) {\r\n              $('.delete-iep-modal').modal('hide');\r\n              $('.iep-snippet.active').remove();\r\n              $('.iep').empty();\r\n              inputElement.parent().removeClass('has-warning');\r\n              inputElement.siblings('.help-block').text('');\r\n            } else {\r\n              inputElement.parent().addClass('has-warning');\r\n              inputElement.siblings('.help-block').text('Sorry, unable to delete this IEP right now. Try again later.');\r\n            }\r\n\r\n            inputElement.val('');\r\n            $('.delete-iep-modal .btn-danger').prop('disabled', false);\r\n            $('.delete-iep-modal .btn-danger > i').addClass('hide');\r\n          });\r\n      } else {\r\n        inputElement.val('');\r\n        inputElement.parent().addClass('has-warning');\r\n        inputElement.siblings('.help-block').text('Sorry, only IEPs with no responses can be deleted.');\r\n        $('.delete-iep-modal .btn-danger').prop('disabled', false);\r\n        $('.delete-iep-modal .btn-danger > i').addClass('hide');\r\n      }\r\n\r\n\r\n    });\r\n}\r\n\r\nfunction activateIep(event) {\r\n  event.stopPropagation();\r\n  event.preventDefault();\r\n\r\n  if (confirm('Activating this IEP will cause the currently active IEP (if any) to become inactive and read-only. Are you sure you want to activate this IEP?')) {\r\n    var iepid = $(event.target).parents('.iep-snippet').prop('id');\r\n\r\n    window.fetch('iep/activate', {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        iep: iepid,\r\n        student: student\r\n      })\r\n    }).then(status)\r\n      .then(json)\r\n      .then(function(response) {\r\n        if (response) {\r\n          $('.iep-status.label-primary')\r\n            .text('Inactive')\r\n            .removeClass('label-primary')\r\n            .addClass('label-warning');\r\n          $(event.target).parents('.iep-snippet').find('.iep-status')\r\n            .text('Active')\r\n            .removeClass('label-warning')\r\n            .addClass('label-primary');\r\n          $(event.target).parent().remove();\r\n        }\r\n      });\r\n  }\r\n}\r\n\r\n$(document).ready(function() {\r\n  resizeContent();\r\n  loadIep();\r\n\r\n  $(window).on('resize', resizeContent);\r\n  $('.new-iep-modal input[type=text]').datepicker({\r\n    format: \"mm/dd/yyyy\",\r\n    autoclose: true,\r\n    todayHighlight: true,\r\n    startDate: \"0d\",\r\n    endDate: \"+1y\"\r\n  });\r\n  $('.new-iep-modal .btn-success').on('click', createIep);\r\n  $('.delete-iep-modal .btn-danger').on('click', deleteIep);\r\n  $('.iep-snippet').on('click', iepSnippetClickHandler);\r\n  $('#activate-iep').on('click', activateIep);\r\n});\r\n"],"sourceRoot":"/source/"}