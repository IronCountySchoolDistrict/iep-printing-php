{"version":3,"sources":["loading-modal.js","iep.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["var loadingModal;\nloadingModal = loadingModal || (function() {\n  var loadingDiv = $('#loadingDialog');\n  return {\n    show: function() {\n      loadingDiv.modal('show');\n    },\n    hide: function() {\n      loadingDiv.modal('hide');\n    }\n  }\n})();\n","var iepContent = {};\n\nfunction status(response) {\n  if (response.status >= 200 && response.status < 300) {\n    return Promise.resolve(response);\n  } else {\n    return Promise.reject(new Error(response.statusText));\n  }\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction html(response) {\n  return response.text();\n}\n\nfunction resizeContent() {\n  var windowHeight = $(window).height();\n  var SPACE_ABOVE_CONTENT = 71;\n  var iepHeight = windowHeight - SPACE_ABOVE_CONTENT;\n  var iepListHeight = iepHeight - 55;\n  $('.iep').css('height', iepHeight + 'px');\n  $('.iep-list').css('height', iepListHeight + 'px');\n}\n\nfunction iepSnippetClickHandler(event) {\n  iepSnippet = $(event.target);\n  if (!iepSnippet.hasClass('iep-snippet')) {\n    iepSnippet = iepSnippet.parents('.iep-snippet');\n  }\n\n  if (iepSnippet.hasClass('active')) {\n    return;\n  }\n\n  loadingModal.show();\n\n  $('.iep-snippet.active .case-manager').replaceWith(function() {\n    return $('<span class=\"'+$(this).prop('class')+'\">' + this.innerHTML + '</span>');\n  });\n  $('.iep-snippet.active .start-date').replaceWith(function() {\n    return $('<span class=\"'+$(this).prop('class')+'\">' + this.innerHTML + '</span>');\n  });\n\n  $('.iep-snippet.active').removeClass('active');\n  iepSnippet.addClass('active');\n\n  loadIep();\n}\n\nfunction loadIep() {\n  $('.iep').empty();\n  var iepid = $('.iep-snippet.active').prop('id');\n  if (typeof iepContent[iepid] === \"undefined\") {\n    var params = [\n      'iep=' + iepid,\n      'frn=' + frn\n    ];\n    window.fetch('iep?' + params.join('&'))\n      .then(status)\n      .then(html)\n      .then(function(html) {\n        $('.iep').append(html);\n        iepContent[iepid] = html;\n        styleIep();\n      });\n  } else {\n    $('.iep').append(iepContent[iepid]);\n    styleIep();\n  }\n}\n\nfunction styleIep() {\n  setSelectedIep($('.iep-snippet.active').prop('id'));\n  $('.iep-table').dataTable({\n    \"paging\": false,\n    \"ordering\": false,\n    \"bInfo\": false\n  });\n\n  $('.iep-table input[type=checkbox], .iep input[type=radio]').iCheck({\n    checkboxClass: 'icheckbox_flat-blue',\n    radioClass: 'iradio_flat-blue'\n  });\n\n  $('.iep-table input[type=checkbox]').on('ifChanged', checkboxWatcher);\n  $('#btnPrintSelection').on('click', printForms);\n\n  var caseManagerHref = $('.iep-table a:contains(\"IEP: SpEd 51\")').prop('href') + '&case_manager';\n  $('.iep-snippet.active .case-manager').replaceWith(function() {\n    return $('<a target=\"_blank\" href=\"'+caseManagerHref+'\" class=\"'+$(this).prop('class')+'\">' + this.innerHTML + '</a>');\n  });\n\n  var startDateHref = $('.iep-table a:contains(\"IEP: SpEd 6a1\")').prop('href') + '&start_date';\n  $('.iep-snippet.active .start-date').replaceWith(function() {\n    return $('<a target=\"_blank\" href=\"'+startDateHref+'\" class=\"'+$(this).prop('class')+'\">' + this.innerHTML + '</a>');\n  });\n\n  loadingModal.hide();\n}\n\nfunction checkboxWatcher(event) {\n  var RESPONSE_CHECKS = '.iep-table input[name=\"response[]\"]';\n\n  var checkboxCount = $(RESPONSE_CHECKS).length;\n  var checkedBoxCount = $(RESPONSE_CHECKS + ':checked').length;\n\n  if (event.target.name === 'master') {\n    if (event.target.checked) {\n      $(RESPONSE_CHECKS).iCheck('check');\n    } else {\n      if (checkboxCount == checkedBoxCount) {\n        $(RESPONSE_CHECKS).iCheck('uncheck');\n      }\n    }\n  } else {\n    if (checkboxCount == checkedBoxCount) {\n      $('.iep-table input[name=master]').iCheck('check');\n    } else {\n      $('.iep-table input[name=master]').iCheck('uncheck');\n    }\n  }\n}\n\nfunction createIep() {\n  var inputElement = $('.new-iep-modal input[name=\"start-date\"]');\n  var dateRegex = /^(0[1-9]|1[0-2])\\/(0[1-9]|1\\d|2\\d|3[01])\\/(19|20)\\d{2}$/;\n\n  if (!dateRegex.test(inputElement.val())) {\n    $('.new-iep-modal .form-group').addClass('has-warning');\n    $('.new-iep-modal .help-block').text('Sorry, the date must math the MM/DD/YYYY format');\n\n    return;\n  }\n\n  $('.new-iep-modal .btn').prop('disabled', true);\n  $('.new-iep-modal .btn-success > i').removeClass('hide');\n\n  window.fetch('iep', {\n    method: 'POST',\n    body: JSON.stringify({\n      start_date: inputElement.val(),\n      user: user,\n      student: student\n    })\n  }).then(status)\n    .then(html)\n    .then(function(data) {\n      $('.iep-list .scroll-content').prepend(data);\n      $('.iep-list .iep-snippet').first().find('.activate-iep').on('click', activateIep);\n      $('.new-iep-modal').modal('hide');\n      $('.new-iep-modal input').val('');\n      $('.new-iep-modal .btn').prop('disabled', false);\n      $('.new-iep-modal .btn-success > i').addClass('hide');\n      $('.iep-list .iep-snippet').first().on('click', iepSnippetClickHandler);\n      $('.iep-list .iep-snippet').first().click();\n    });\n}\n\nfunction printForms() {\n  if ($('.iep-table input[name=\"response[]\"]:checked').length < 1) {\n    alert('There are no forms selected.');\n    return;\n  }\n\n  togglePrintBtn('disable');\n\n  var selected = [];\n  $('.iep-table input[name=\"response[]\"]:checked').each(function(index, element) {\n    selected.push({\n      formid: $(element).attr('data-form-id'),\n      title: $(element).attr('data-form-title'),\n      responseid: $(element).val()\n    });\n  });\n\n  window.fetch('iep/print', {\n    method: 'POST',\n    body: JSON.stringify({\n      selected: selected,\n      student: student,\n      fileOption: $('input[name=fileOption]:checked').val(),\n      watermarkOption: $('input[name=watermarkOption]:checked').val()\n    })\n  }).then(status)\n    .then(json)\n    .then(function(data) {\n      if (typeof data.file !== 'undefined' && data.file.length > 0) {\n        var win = window.open(data.file, '_blank');\n        if (win) {\n          win.focus();\n        } else {\n          alert('ERROR: Please allow popups for this page.'); // TODO: better way to alert/inform?\n        }\n      }\n\n      $('input[name=\"response[]\"]:checked').each(function(index, element) {\n        var parentElement = $(element).parents('tr');\n        if (parentElement.hasClass('error')) {\n          $(element).parents('tr').removeClass('error');\n          $(element).parents('tr').find('.form-error').text('');\n        }\n      });\n\n      for (var key in data.error) {\n        var row = $('.iep-table #' + key);\n        row.addClass('error');\n        row.find('.form-error').text(data.error[key]);\n      }\n\n      togglePrintBtn('enable');\n    }).catch(function(error) {\n      console.log(error);\n      togglePrintBtn('enable');\n    });\n}\n\nfunction togglePrintBtn(action) {\n  if (action === 'disable') {\n    $('#btnPrintSelection').prop('disabled', true);\n    $('#btnPrintSelection > i').removeClass('hide');\n  } else {\n    $('#btnPrintSelection').prop('disabled', false);\n    $('#btnPrintSelection > i').addClass('hide');\n  }\n}\n\nfunction deleteIep() {\n  var inputElement = $('.delete-iep-modal input[name=\"confirm-delete\"]');\n\n  if (inputElement.val() !== 'DELETE') {\n    inputElement.val('');\n    inputElement.parent().addClass('has-warning');\n    inputElement.siblings('.help-block').text('Sorry, please enter the text exactly as displayed to confirm.');\n    inputElement.focus();\n\n    return;\n  }\n\n  $('.delete-iep-modal .btn-danger').prop('disabled', true);\n  $('.delete-iep-modal .btn-danger > i').removeClass('hide');\n\n  inputElement.parent().removeClass('has-warning');\n  inputElement.siblings('.help-block').text('');\n\n  var iepid = $('.iep-snippet.active').prop('id');\n\n  window.fetch('iep/response-count?iep=' + iepid)\n    .then(status)\n    .then(json)\n    .then(function(count) {\n      if (count < 1) {\n        window.fetch('iep/delete', {\n          method: 'POST',\n          body: JSON.stringify({\n            iep: iepid\n          })\n        }).then(status)\n          .then(json)\n          .then(function(response) {\n            if (response) {\n              $('.delete-iep-modal').modal('hide');\n              $('.iep-snippet.active').remove();\n              $('.iep').empty();\n              inputElement.parent().removeClass('has-warning');\n              inputElement.siblings('.help-block').text('');\n            } else {\n              inputElement.parent().addClass('has-warning');\n              inputElement.siblings('.help-block').text('Sorry, unable to delete this IEP right now. Try again later.');\n            }\n\n            inputElement.val('');\n            $('.delete-iep-modal .btn-danger').prop('disabled', false);\n            $('.delete-iep-modal .btn-danger > i').addClass('hide');\n          });\n      } else {\n        inputElement.val('');\n        inputElement.parent().addClass('has-warning');\n        inputElement.siblings('.help-block').text('Sorry, only IEPs with no responses can be deleted.');\n        $('.delete-iep-modal .btn-danger').prop('disabled', false);\n        $('.delete-iep-modal .btn-danger > i').addClass('hide');\n      }\n\n\n    });\n}\n\nfunction activateIep(event) {\n  console.log('activate');\n  event.stopPropagation();\n  event.preventDefault();\n\n  if (confirm('Activating this IEP will cause the currently active IEP (if any) to become inactive and read-only. Are you sure you want to activate this IEP?')) {\n    var iepid = $(event.target).parents('.iep-snippet').prop('id');\n\n    window.fetch('iep/activate', {\n      method: 'POST',\n      body: JSON.stringify({\n        iep: iepid,\n        student: student\n      })\n    }).then(status)\n      .then(json)\n      .then(function(response) {\n        if (response) {\n          $('.iep-status.label-primary')\n            .text('Inactive')\n            .removeClass('label-primary')\n            .addClass('label-warning');\n          $(event.target).parents('.iep-snippet').find('.iep-status')\n            .text('Active')\n            .removeClass('label-warning')\n            .addClass('label-primary');\n          $(event.target).parent().remove();\n        }\n      });\n  }\n}\n\nfunction setSelectedIep(iepid) {\n  localStorage.setItem('iep', iepid);\n}\n\nfunction getSelectedIep() {\n  return localStorage.getItem('iep');\n}\n\n$(document).ready(function() {\n  resizeContent();\n  if (getSelectedIep() && $('.iep-snippet#' + getSelectedIep()).length > 0) {\n    $('.iep-snippet.active').removeClass('active');\n    $('.iep-snippet#' + getSelectedIep()).addClass('active');\n    loadIep();\n  } else if ($('.iep-snippet.active').length > 0) {\n    loadIep();\n  }\n\n  $(window).on('resize', resizeContent);\n  $('.new-iep-modal input[type=text]').datepicker({\n    format: \"mm/dd/yyyy\",\n    autoclose: true,\n    todayHighlight: true,\n    startDate: \"0d\",\n    endDate: \"+1y\"\n  });\n  $('.new-iep-modal .btn-success').on('click', createIep);\n  $('.delete-iep-modal .btn-danger').on('click', deleteIep);\n  $('.iep-snippet').on('click', iepSnippetClickHandler);\n  $('.activate-iep').on('click', activateIep);\n});\n"]}